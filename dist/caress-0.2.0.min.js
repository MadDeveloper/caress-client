;((t,o)=>{"function"==typeof define&&define.amd?define(["underscore","socket.io-client"],function(e,s){return t.Caress=o(e,s)}):"object"==typeof module&&module.exports?module.exports=o(require("underscore"),require("socket.io-client")):t.Caress=o(t._,t.io)})("undefined"!=typeof self?self:this,(t,o)=>{const e={version:"0.2.0",protocol:"1.1"},s=e.Client=function(o={}){this.host=o.host||"127.0.0.1",this.port=o.port||5e3,this.connected=!1,this.sessions={},this.cursors={},this.objects={},this.blobs={},this.touches={},this.touchList=r(),t.bindAll(this,"connect","onConnect","onDisconnect","processPacket","processMessage","processCursorSource","processObjectSource","processBlobSource","processCursorAlive","processObjectAlive","processBlobAlive","processCursorSet","processObjectSet","processBlobSet","processFseq")};s.prototype.connect=function(){this.socket=o.connect(`http://${this.host}:${this.port}`),this.socket.on("connect",this.onConnect),this.socket.on("disconnect",this.onDisconnect)},s.prototype.onConnect=function(){this.connected=!0,this.socket.on("tuio",this.processPacket),console.log("Connected to Socket.io")},s.prototype.onDisconnect=function(){this.connected=!1;for(let t in this.touches)for(let o in this.touches[t]){const e=this.touches[t][o];delete this.touches[t][o],this.createTouchEvent("touchcancel",e)}this.touches={},this.cursors={},this.objects={},this.blobs={},console.log("Disconnected from Socket.io")},s.prototype.processPacket=function(t){t.bundle&&this.processMessage(t)},s.prototype.processMessage=function(t){const o={source:this.processCursorSource,alive:this.processCursorAlive,set:this.processCursorSet,fseq:this.processFseq},e={source:this.processObjectSource,alive:this.processObjectAlive,set:this.processObjectSet,fseq:this.processFseq},s={source:this.processBlobSource,alive:this.processBlobAlive,set:this.processBlobSet,fseq:this.processFseq};if(!t.duplicate){t.source="localhost";for(let c in t.messages){const i=t.messages[c].type;switch(t.messages[c].profile){case"/tuio/2Dcur":case"/tuio/25Dcur":case"/tuio/3Dcur":o[i](t,t.messages[c]);break;case"/tuio/2Dobj":case"/tuio/25Dobj":case"/tuio/3Dobj":e[i](t,t.messages[c]);break;case"/tuio/2Dblb":case"/tuio/25Dblb":case"/tuio/3Dblb":s[i](t,t.messages[c])}}}},s.prototype.processCursorSource=function(t,o){t.source=o.address,void 0===this.cursors[t.source]&&(this.cursors[t.source]={}),void 0===this.touches[t.source]&&(this.touches[t.source]={})},s.prototype.processObjectSource=function(t,o){t.source=o.address,void 0===this.objects[t.source]&&(this.objects[t.source]={}),void 0===this.touches[t.source]&&(this.touches[t.source]={})},s.prototype.processBlobSource=function(t,o){t.source=o.address,void 0===this.blobs[t.source]&&(this.blobs[t.source]={}),void 0===this.touches[t.source]&&(this.touches[t.source]={})},s.prototype.processCursorAlive=function(o,e){void 0===this.cursors[o.source]&&(this.cursors[o.source]={}),void 0===this.touches[o.source]&&(this.touches[o.source]={});const s=t.map(e.sessionIds,t=>t.toString()),c=t.difference(t.keys(this.cursors[o.source]),s),i=c.length;for(let t=0;t<i;t++){const e=c[t],s=this.touches[o.source][e];void 0!==s&&(delete this.touches[o.source][e],delete this.cursors[o.source][e],this.createTouchEvent("touchend",s))}},s.prototype.processObjectAlive=function(o,e){void 0===this.objects[o.source]&&(this.objects[o.source]={}),void 0===this.touches[o.source]&&(this.touches[o.source]={});const s=t.map(e.sessionIds,t=>t.toString()),c=t.difference(t.keys(this.objects[o.source]),s),i=c.length;for(let t=0;t<i;t++){const e=c[t],s=this.touches[o.source][e];void 0!==s&&(delete this.touches[o.source][e],delete this.objects[o.source][e],this.createTouchEvent("touchend",s))}},s.prototype.processBlobAlive=function(o,e){void 0===this.blobs[o.source]&&(this.blobs[o.source]={}),void 0===this.touches[o.source]&&(this.touches[o.source]={});const s=t.map(e.sessionIds,t=>t.toString()),c=t.difference(t.keys(this.blobs[o.source]),s),i=c.length;for(let t=0;t<i;t++){const e=c[t],s=this.touches[o.source][e];void 0!==s&&(delete this.touches[o.source][e],delete this.blobs[o.source][e],this.createTouchEvent("touchend",s))}},s.prototype.processCursorSet=function(t,o){const e=new c(o),s=e.coherceToTouch(),i=o.sessionId.toString();if(void 0!==this.cursors[t.source][i]&&this.cursors[t.source][i].sessionId.toString()===i)return this.cursors[t.source][i]=e,void 0!==this.touches[t.source][i]&&this.touches[t.source][i].identifier.toString()===i?(this.touches[t.source][i]=s,void this.createTouchEvent("touchmove",s)):void 0;this.cursors[t.source][i]=e,this.touches[t.source][i]=s,this.createTouchEvent("touchstart",s)},s.prototype.processObjectSet=function(t,o){const e=o.sessionId.toString();if(void 0!==this.objects[t.source][e]&&this.objects[t.source][e].sessionId.toString()===e){if(this.objects[t.source][e]=new i(o),void 0!==this.touches[t.source][e]&&this.touches[t.source][e].identifier.toString()===e){const o=this.objects[t.source][e].coherceToTouch();return this.touches[t.source][e]=o,void this.createTouchEvent("touchmove",o)}return}const s=new i(o),c=s.coherceToTouch();this.objects[t.source][e]=s,this.touches[t.source][e]=c,this.createTouchEvent("touchstart",c)},s.prototype.processBlobSet=function(t,o){const e=o.sessionId.toString();if(void 0!==this.blobs[t.source][e]&&this.blobs[t.source][e].sessionId.toString()===e){if(this.blobs[t.source][e]=new n(o),void 0!==this.touches[t.source][e]&&this.touches[t.source][e].identifier.toString()===e){const o=this.blobs[t.source][e].coherceToTouch();return this.touches[t.source][e]=o,void this.createTouchEvent("touchmove",o)}return}const s=new n(o),c=s.coherceToTouch();this.blobs[t.source][e]=s,this.touches[t.source][e]=c,this.createTouchEvent("touchstart",c)},s.prototype.processFseq=function(t,o){},s.prototype.getCursor=function(t){return this.cursors[t]},s.prototype.getObject=function(t){return this.objects[t]},s.prototype.getBlob=function(t){return this.blobs[t]},s.prototype.getCursors=function(){return this.cursors},s.prototype.getObjects=function(){return this.objects},s.prototype.getBlobs=function(){return this.blobs},s.prototype.createTouchEvent=function(t,o){const e=[];for(let t in this.touches)for(let o in this.touches[t])e.push(this.touches[t][o]);const s=function(t){const o=r();for(let e in window.client.touches)for(let s in window.client.touches[e]){const c=window.client.touches[e][s];c.target==t.target&&o.push(c)}return o}(o),c=r(o),i=new TouchEvent(t,{touches:e,targetTouches:s,changedTouches:c});i.classId=o.classId,o.target?o.target.dispatchEvent(i):document.dispatchEvent(i)};const c=e.TuioCursor=function(t){for(let o in t)this[o]=t[o]};c.prototype.coherceToTouch=function(){const t=this.sessionId,o=window.innerWidth*this.xPosition,e=window.innerHeight*this.yPosition,s=document.documentElement.clientWidth*this.xPosition,c=document.documentElement.clientHeight*this.yPosition,i=document.elementFromPoint(s,c),n=screen.width*this.xPosition,r=screen.height*this.yPosition,u=this.radius,h=this.radius,d=this.rotationAngle,l=this.force;return new Touch({target:i,identifier:t,clientX:o,clientY:e,pageX:s,pageY:c,screenX:n,screenY:r,radiusX:u,radiusY:h,rotationAngle:d,force:l})};const i=e.TuioObject=function(t){for(let o in t)this[o]=t[o]};i.prototype.coherceToTouch=function(){const t=this.sessionId,o=window.innerWidth*this.xPosition,e=window.innerHeight*this.yPosition,s=document.documentElement.clientWidth*this.xPosition,c=document.documentElement.clientHeight*this.yPosition,i=document.elementFromPoint(s,c),n=screen.width*this.xPosition,r=screen.height*this.yPosition,u=this.radius,h=this.radius,d=this.rotationAngle,l=this.force,p=new Touch({target:i,identifier:t,clientX:o,clientY:e,pageX:s,pageY:c,screenX:n,screenY:r,radiusX:u,radiusY:h,rotationAngle:d,force:l});return p.classId=this.classId,p};const n=e.TuioBlob=function(t){for(let o in t)this[o]=t[o]};function r(t){return Array.isArray(t)?t:void 0!==t?[t]:[]}return n.prototype.coherceToTouch=function(){const t=this.sessionId,o=window.innerWidth*this.xPosition,e=window.innerHeight*this.yPosition,s=document.documentElement.clientWidth*this.xPosition,c=document.documentElement.clientHeight*this.yPosition,i=document.elementFromPoint(s,c),n=screen.width*this.xPosition,r=screen.height*this.yPosition,u=this.radius,h=this.radius,d=this.rotationAngle,l=this.force;return new Touch({target:i,identifier:t,clientX:o,clientY:e,pageX:s,pageY:c,screenX:n,screenY:r,radiusX:u,radiusY:h,rotationAngle:d,force:l})},window.ontouchstart=document.ontouchstart=null,window.ontouchend=document.ontouchend=null,window.ontouchmove=document.ontouchmove=null,window.ontouchcancel=document.ontouchcancel=null,window.ontouchenter=document.ontouchenter=null,window.ontouchleave=document.ontouchleave=null,e});
